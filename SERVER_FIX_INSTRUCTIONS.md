# Исправление проблем с загрузкой CSS и JS на сервере

## Проблемы которые были обнаружены:

1. **Отсутствующие JS файлы** - В HTML подключались файлы, которых не было в папке `public/js/`
2. **Неправильные настройки Helmet** - CSP блокировал загрузку ресурсов
3. **Некорректные CORS настройки** для продакшена

## Что было исправлено:

### 1. Созданы недостающие JS файлы:
- `public/js/timesheet.js`
- `public/js/materials.js` 
- `public/js/documents.js`
- `public/js/reports.js`
- `public/js/settings.js`

### 2. Обновлены настройки сервера в `server.js`:
- Настроен Content Security Policy для разрешения загрузки внешних ресурсов
- Исправлены CORS настройки для вашего IP адреса
- Добавлены разрешения для Google Fonts и Font Awesome

### 3. Создан правильный `.env` файл
### 4. Создан скрипт запуска `start_server.sh`
### 5. Создан тестовый файл `public/test.html`

## Инструкции для запуска на сервере:

### Шаг 1: Подключитесь к серверу
```bash
ssh root@79.174.85.87
```

### Шаг 2: Перейдите в папку проекта
```bash
cd /root/Crm
```

### Шаг 3: Остановите текущий процесс (если запущен)
```bash
# Найдите процесс Node.js
ps aux | grep node

# Остановите процесс (замените PID на реальный номер процесса)
kill -9 PID_НОМЕР

# Или остановите все процессы Node.js
pkill -f node
```

### Шаг 4: Скопируйте исправленные файлы
Замените файлы на сервере исправленными версиями из этого проекта:
- `server.js`
- `.env` 
- `start_server.sh`
- Все файлы в `public/js/` (особенно новые)

### Шаг 5: Установите права доступа
```bash
chmod +x start_server.sh
chmod -R 755 public/
mkdir -p uploads logs exports
chmod -R 777 uploads/ logs/ exports/
```

### Шаг 6: Запустите сервер новым скриптом
```bash
./start_server.sh
```

ИЛИ запустите напрямую:
```bash
NODE_ENV=production node server.js
```

### Шаг 7: Проверьте работу
1. Откройте http://79.174.85.87:3000/test.html для диагностики
2. Откройте http://79.174.85.87:3000/ для основного сайта

## Проверка в браузере:

### 1. Откройте инструменты разработчика (F12)
### 2. Перейдите на вкладку Network/Сеть
### 3. Обновите страницу
### 4. Проверьте что все CSS и JS файлы загружаются со статусом 200

## Дополнительные команды для диагностики:

### Проверка процессов:
```bash
ps aux | grep node
netstat -tulpn | grep :3000
```

### Проверка логов:
```bash
tail -f logs/server.log
tail -f logs/error.log
```

### Проверка файлов:
```bash
ls -la public/css/
ls -la public/js/
```

## Возможные дополнительные проблемы:

1. **Брандмауэр** - убедитесь что порт 3000 открыт:
```bash
ufw allow 3000
```

2. **Права доступа** - убедитесь что у файлов правильные права:
```bash
chown -R www-data:www-data /root/Crm/public/
```

3. **Node.js версия** - убедитесь что установлена версия 18+:
```bash
node --version
npm --version
```

## Если проблемы остаются:

1. Проверьте логи сервера в `logs/server.log`
2. Откройте консоль браузера для ошибок JavaScript
3. Проверьте Network tab для failed requests
4. Убедитесь что все файлы существуют в правильных путях

## Контакты для поддержки:
После выполнения этих инструкций ваш сайт должен корректно загружать CSS и JS файлы.