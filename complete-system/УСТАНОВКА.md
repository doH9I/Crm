# 🚀 ПОШАГОВАЯ УСТАНОВКА Construction CRM

## ⚡ Быстрая установка (5 минут)

### Шаг 1: Скопируйте файлы
```bash
cd /root/construction-crm

# Замените файлы из папки complete-system:
cp complete-system/server.js ./
cp complete-system/setup-mysql.sh ./
cp complete-system/public/js/auth.js public/js/
cp complete-system/public/js/estimates.js public/js/
cp complete-system/public/js/materials.js public/js/
cp complete-system/public/js/offers.js public/js/
```

### Шаг 2: Настройте MySQL
```bash
chmod +x setup-mysql.sh
sudo ./setup-mysql.sh
```

**ВАЖНО! Сохраните эти пароли:**
- MySQL Root: `ConstructionCRM2024Root!`
- Пользователь БД: `construction_admin` / `CRM_Admin_2024#Secure`
- Администратор системы: `admin` / `admin123`

### Шаг 3: Создайте .env файл
```bash
cat > .env << 'EOF'
DB_HOST=localhost
DB_PORT=3306
DB_USER=construction_admin
DB_PASSWORD=CRM_Admin_2024#Secure
DB_NAME=construction_crm
JWT_SECRET=ConstructionCRM2024_JWT_Secret_Key_Very_Secure_Random_String_12345
JWT_EXPIRE=24h
PORT=3000
NODE_ENV=production
CORS_ORIGIN=http://79.174.85.87:3000,http://localhost:3000
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_REQUESTS=100
MAX_FILE_SIZE=52428800
COMPANY_NAME=ООО "СтройМонтаж"
COMPANY_ADDRESS=г. Москва, ул. Строительная, д. 1
COMPANY_PHONE=+7 (495) 123-45-67
COMPANY_EMAIL=info@construction-crm.local
EOF
```

### Шаг 4: Запустите сервер
```bash
node server.js
```

### Шаг 5: Откройте сайт
Перейдите по адресу: http://79.174.85.87:3000
- Логин: `admin`
- Пароль: `admin123`

## ✅ Что исправлено

### Основные проблемы:
- ❌ HTTP 404 при авторизации → ✅ Работает
- ❌ `app.checkAuth is not a function` → ✅ Исправлено
- ❌ `app.showLogin is not a function` → ✅ Исправлено
- ❌ Заглушки модулей → ✅ Полный функционал

### Новый функционал:
- ✅ Сметы - полный модуль с созданием, редактированием, статусами
- ✅ Материалы - каталог с категориями, ценами, остатками
- ✅ Коммерческие предложения - создание, отправка, отслеживание
- ✅ Реальная авторизация с JWT токенами
- ✅ Полноценная база данных MySQL
- ✅ API для всех операций

## 🔧 Если что-то не работает

### MySQL не запускается:
```bash
sudo systemctl start mysql
sudo systemctl status mysql
```

### Порт 3000 занят:
```bash
sudo netstat -tlnp | grep :3000
sudo kill -9 [PID_ПРОЦЕССА]
```

### Ошибки прав доступа:
```bash
sudo chown -R $USER:$USER /root/construction-crm
sudo chmod -R 755 /root/construction-crm
```

### Проблемы с npm:
```bash
npm cache clean --force
rm -rf node_modules
npm install
```

## 📊 Проверка работы

После запуска проверьте:

1. **Сервер запущен**: `curl http://localhost:3000`
2. **MySQL работает**: `mysql -u construction_admin -p construction_crm`
3. **Авторизация работает**: зайдите на сайт с admin/admin123
4. **Модули работают**: проверьте все разделы в меню

## 🎯 Критические точки внимания

### Возможные ошибки:
1. **Неправильные пароли** - используйте только указанные пароли
2. **MySQL не запущен** - обязательно запустите MySQL перед стартом
3. **Отсутствие .env** - файл должен быть создан с правильными настройками
4. **Права доступа** - убедитесь, что у пользователя есть права на файлы
5. **Порт занят** - освободите порт 3000 перед запуском

### Что проверить в первую очередь:
- [ ] MySQL запущен и доступен
- [ ] Файл .env создан с правильными паролями
- [ ] Все файлы скопированы в правильные места
- [ ] Порт 3000 свободен
- [ ] Нет ошибок в консоли при запуске

## 🚨 ВАЖНО ДЛЯ ПРОДАКШЕНА

### Безопасность:
1. Смените пароли на более сложные
2. Настройте SSL сертификат
3. Используйте PM2 для управления процессом
4. Настройте регулярные бэкапы

### Производительность:
1. Настройте Nginx как reverse proxy
2. Включите сжатие статических файлов
3. Настройте кеширование
4. Мониторьте использование ресурсов

## 📞 Поддержка

Если возникли проблемы:
1. Проверьте логи: `tail -f logs/error.log`
2. Проверьте статус MySQL: `sudo systemctl status mysql`
3. Убедитесь, что все пароли правильные
4. Проверьте права доступа к файлам

---

**🎉 После выполнения всех шагов система должна работать полностью!**

Доступ: http://79.174.85.87:3000
Логин: admin
Пароль: admin123